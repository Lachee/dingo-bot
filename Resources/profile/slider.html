<head>
	<link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
	<script src="./js/jquery-3.4.1.min.js"></script>
	<script src="https://simeydotme.github.io/jQuery-ui-Slider-Pips/dist/js/jquery-plus-ui.min.js"></script>
    <script src="./js/jquery-ui-slider-pips.min.js"> </script>
    <script src="DEFAULT_PROFILE.js"></script>
	
	<!--
	<link rel="stylesheet" type="text/css" href="./js/jquery-ui.min.css">
	<link rel="stylesheet" type="text/css" href="./js/jquery-ui-slider-pips.min.css">
	<link rel="stylesheet" type="text/css" href="./css/slider.css">
	-->
	
	<link rel="stylesheet" type="text/css" href="https://simeydotme.github.io/jQuery-ui-Slider-Pips/dist/css/jqueryui.min.css">
	<link rel="stylesheet" type="text/css" href="https://simeydotme.github.io/jQuery-ui-Slider-Pips/dist/css/jquery-ui-slider-pips.min.css">
	<link rel="stylesheet" type="text/css" href="https://simeydotme.github.io/jQuery-ui-Slider-Pips/dist/css/app.min.css">
	<link rel="stylesheet" type="text/css" href="./css/slider.css">
    <style>
        body {
            /*font-family: "Open Sans","Helvetica Neue",Roboto,Arial,sans-serif;*/
			font-family: 'Roboto', sans-serif;
			background: white;
            color: black;
            padding: 0;
            margin: 0;
        }


        .profile {
            width: 540px;
            height: 450px;
            background: #434c5b;
            padding: 20px;
            color: #dddddd;

            background: url('img/pattern.jpg');
            background-size: cover;
        }

        .profile-header {
            height: 185px;
        }

        img.avatar {
            height: 157px;
            float: left;
            position: absolute;
            border-radius: 115px;
            left: 0px;
            top: 0px;
        }

        img.rank {
            float: left;
            height: 70px;
            position: absolute;
            top: 100px;
            left: 111px;
            z-index: 999;
        }

        .profile-header .avatar-box {
            width: 185px;
            float: left;
            height: 100%;
            position: relative;
        }

        .profile-header .title {
            float: left;
            padding-top: 3px;
            height: 100%;
            width: 314px;
        }

        .profile-header .title .name {
            text-align: right;
            font-size: 29pt;
            font-weight: bold;
        }

        .profile-header .title .desc {
            text-align: right;
            font-size: 19pt;
            margin-top: -10px;
        }

        .profile-content #flat-slider {
            margin-left: 20px;
            margin-right: 20px;
        }
 
        .profile-header #flat-slider {
            margin-top: 39px;
        }

        .profile-header span.ui-slider-handle.ui-state-default.ui-corner-all {
            width: 14px;
            height: 14px;
            top: -17px !important;
            margin-left: -7px !important;
        }

        .profile-header span.ui-slider-handle.ui-state-default.ui-corner-all.current {
            width: 20px;
            height: 20px;
            top: -25px !important;
            margin-left: -10px;
        }

        .profile-header .title .ui-slider-handle.current div {
            color: white;
            transform: rotate(-45deg);
            -webkit-transform: rotateZ(-45deg);
            bottom: -43px;
            right: -49px;
            position: absolute;
        }

        .top-operators #attacker, .top-operators #defender {
            width: 80px;
            float: left;
        }

        .top-operators .slider {
            margin-left: 22px;
        }

        .top-stats {
            position: absolute;
            top: 180px;
            left: 190px;
        }

        .top-stats .stat {
            float: left;
            width: 150px;
            margin-top: 35px;
        }

        .top-stats .stat span {
            display: block;
            text-align: center;
        }

        .top-stats .stat span#value {
            font-size: 22pt;
            font-weight: bold;
        }

        .top-stats .stat span#label {
            font-size: 10pt;
        }

        .unranked .top-stats {
            top: 130px;
            left: 190px;
        }

        .unranked .rank, .unranked .title #flat-slider {
            display: none;
        }
    </style>
</head>
<body>

<div class="profile">
    <div class="profile-header">
        <div class="avatar-box">
            <img class="avatar" data-src="r6.Profile.Avatar" src="https://chickatrice.net/chickatrice.png"/>
            <img class="rank"  data-src="r6.Profile.RankSVG" src="https://chickatrice.net/chickatrice.png"/>
        </div>
        <div class="title">
            <div class="name" data-text="r6.Name">KommadantKlink</div>
            <div class="desc" data-text="r6.ProfileDataTTL">Montagne Main</div>
            <div id="flat-slider"></div>
        </div>
    </div>
    <div class="profile-content">
        <div class="top-operators">
            <div id="attacker">
                <div class="slider"><div id="flat-slider-vertical-1"></div></div>
                <img class="icon" src="https://trackercdn.com/rainbow6-ubi/assets/images/badge-blitz.cd45df08f6.png"/>
            </div>
            <div id="defender">
                <div class="slider"><div id="flat-slider-vertical-2"></div></div>
                <img class="icon" src="https://trackercdn.com/rainbow6-ubi/assets/images/badge-tachanka.ae7943f00d.png"/>
            </div>
        </div>
        <div class="top-stats">
            <div class="top">
                <div class="stat">
                    <span id="value" data-text="r6.Profile.meta.level">000</span>
                    <span id="label">Level</span>
                </div>
                <div class="stat">
                    <span id="value" data-text="r6.Profile.general.time_played">000</span>
                    <span id="label">Played</span>
                </div>
            </div>
            <div class="bottom">
                <div class="stat">
                    <span id="value" data-text="r6.Formatted.WinPercent">000</span>
                    <span id="label">Win %</span>
                </div>
                <div class="stat">
                    <span id="value" data-text="r6.Formatted.KD">000</span>
                    <span id="label">KD</span>
                </div>
            </div>
        </div>
    </div>
</div>




</body>
<script>
    console.log("Hello World!");

	//$.extend( $.ui.slider.prototype.options, {  animate: 300 });
	//The profile from d.lu.je/siege/profile.php
	var profile = getProfile();
	console.log("r6. ", profile);

    //Add the time components to each operator
    var mostPlayed = "";
    var mostPlayedTime = 0;

    for(var name in profile.Operators) {         
        var time = profile.Operators[name].time_played;
        var joined = time.replace("d", "").replace("h", "").replace("m", "");
        var timeparts = joined.split(" ");
        var value = (timeparts[timeparts.length - 1] * 60) + (timeparts[timeparts.length - 2] * 60 * 60);
        profile.Operators[name].TimePlayed = value;

        if (value > mostPlayedTime) {
            mostPlayedTime = value;
            mostPlayed = name;
        }
    }

    $('.title .desc').text(mostPlayed + " Main");

    //Format the KD
    profile.Formatted = {
        WinPercent: (profile.Profile.general.WinPercent * 100).toFixed(1) + "%",
        KD: (profile.Profile.general.KD).toFixed(2),
    }
    
    //Set the unranked
    if (!profile.IsRanked) {
        $('.profile').addClass("unranked");
    }

	//Set all the things
    setMMRSlider();
    setAttributes();
    setOperatorSliders();
    
    function setOperatorSliders() {

        var topAttacker = "FINKA";
        var topDefender = "GOYO";

        var topAttackerValue = 0;
        var topDefenderValue = 0;

        for(var name in profile.Operators) {
            if (profile.Operators[name].team == "Attackers" && profile.Operators[name].TimePlayed > topAttackerValue) {
                topAttackerValue = profile.Operators[name].TimePlayed;
                topAttacker = name;
            }

            if (profile.Operators[name].team == "Defenders" && profile.Operators[name].TimePlayed > topDefenderValue) {
                topDefenderValue = profile.Operators[name].TimePlayed;
                topDefender = name;
            }
        }


        $("#flat-slider-vertical-1")
            .slider({
                max: 100,
                min: 0,
                range: "min",
                //value: profile.Operators[topAttacker].KD * 50,
                value: profile.Operators[topAttacker].WinPercent * 100,
                orientation: "vertical"
            });

        $("#flat-slider-vertical-2")
            .slider({
                max: 100,
                min: 0,
                range: "min",
                //value: profile.Operators[topDefender].KD * 50,
                value: profile.Operators[topDefender].WinPercent * 100,
                orientation: "vertical"
            });
        
        $("#flat-slider-vertical-1, #flat-slider-vertical-2, #flat-slider-vertical-3")
            .slider("pips", {
                first: "pip",
                last: "pip"
            }).slider('float');
            
        $('.profile-content #attacker .icon').attr('src', profile.Operators[topAttacker].img);
        $('.profile-content #defender .icon').attr('src', profile.Operators[topDefender].img);
    }
	
	function setAttributes() {
		function setattr(prefix, object) {
            
			for(var key in object) {
				var o = object[key];
				var t = typeof o;
				
				//If we are a correct type, set the values.
				// Otherwise go a level deeper.
				if (t == 'number' || t == 'string' || t == 'boolean') {
					$('[data-text="' + prefix + key + '"]').text(o);
					$('img[data-src="' + prefix + key + '"]').attr('src', o);

                    //console.log(prefix + key , "=", o);
				} else {
					setattr(prefix + key + ".", o);
				}
            }
		}
		
		setattr("r6.", profile);
	}
	
	
	//Set the slider
	function setMMRSlider() {
		var slider = $("#flat-slider");
		var minMMR = profile.MMRHistory.Minimum;
		var currentMMR = profile.MMRHistory.Current;
		var maxMMR = profile.MMRHistory.Maximum;			
	
        //Just so it doesn't look like visual turds, I am adveraging it.
        //if (currentMMR == minMMR) 
        //    currentMMR = profile.MMRHistory.Average;

    	var rangeMinMMR = profile.MMRHistory.RankBelowMinimum; //minMMR - (minMMR * 0.1);
		var rangeMaxMMR = profile.MMRHistory.RankAboveMaximum; //maxMMR + (maxMMR * 0.1);
	
		//Add the slider
		slider
			.slider({
				min: rangeMinMMR,
				max: rangeMaxMMR,
				range: true,
				values: [minMMR, maxMMR]
			}).slider("pips", { first: "pip", last: "pip" });

		//Add the fake pip
		var left = ((currentMMR - rangeMinMMR) / (rangeMaxMMR - rangeMinMMR)) * 100;
		var fakePip = $("<span></span>").addClass('ui-slider-handle ui-state-default ui-corner-all current').css('left', left + "%");  
        fakePip.html("<div>"+currentMMR+"</div>");
		slider.prepend(fakePip);
	}
    
	function getProfile() {
        var profile = getCookie("profile");

        if (profile == "") { 
            profile = DEFAULT_PROFILE;
        } else {
            profile = decodeURIComponent(profile);
        }

        var json = atob(profile);
		return JSON.parse(json);
	}

	function getCookie(cname) {
	  var name = cname + "=";
	  var decodedCookie = decodeURIComponent(document.cookie);
	  var ca = decodedCookie.split(';');
	  for(var i = 0; i <ca.length; i++) {
		var c = ca[i];
		while (c.charAt(0) == ' ') {
		  c = c.substring(1);
		}
		if (c.indexOf(name) == 0) {
		  return c.substring(name.length, c.length);
		}
	  }
	  return "";
	}
	
	function setCookie(cname, cvalue, exdays) {
	  var d = new Date();
	  d.setTime(d.getTime() + (exdays*24*60*60*1000));
	  var expires = "expires="+ d.toUTCString();
	  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	}

	/*
$("#flat-slider-vertical-1")
    .slider({
        max: 25,
        min: 0,
        range: "min",
        value: 25,
        orientation: "vertical"
    });

    $("#flat-slider-vertical-2")
    .slider({
        max: 25,
        min: 0,
        range: "max",
        value: 12,
        orientation: "vertical"
    });

$("#flat-slider-vertical-3")
    .slider({
        max: 25,
        min: 0,
        range: "min",
        value: 0,
        orientation: "vertical"
    });

    $("#flat-slider-vertical-1, #flat-slider-vertical-2, #flat-slider-vertical-3")
    .slider("pips", {
        first: "pip",
        last: "pip"
    })
    .slider("float");
	*/

    
</script>
